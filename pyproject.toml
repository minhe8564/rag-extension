[project]
name = "rag-data-marker"
version = "0.1.0"
description = "RAG Data Marker - PDF/TXT/Excel to Markdown converter"
requires-python = ">=3.11"
dependencies = [
    "fastapi==0.116.2",
    "pydantic-settings>=2.11.0",
    "uvicorn[standard]>=0.38.0",
    "scipy==1.15.3",
    "scikit-learn==1.7.2",
    "python-multipart>=0.0.6",
    "marker-pdf==1.7.3",
    "pypdfium2>=4.30.0",
    "numpy<2.2.6",
    "pillow>=10.4.0",
    "httpx>=0.28.0",
    "requests>=2.32.0",
    "tqdm>=4.67.0",
    "pandas>=2.0.0",
    "openpyxl>=3.1.0",
    "xlrd>=2.0.0",
    "tabulate>=0.9.0",

    # PyTorch - 플랫폼별로 자동 선택
    # Mac (darwin): MPS 지원 버전 (기본 PyPI)
    # Linux/Windows: 기본 PyPI에서 설치 (CUDA 버전이 필요하면 별도 설치 필요)
    "torch==2.7.0; sys_platform == 'darwin'",
    "torchvision>=0.22,<1; sys_platform == 'darwin'",
    "torchaudio>=2.7,<3; sys_platform == 'darwin'",
    # Linux/Windows: 기본 PyPI에서 설치
    # CUDA 버전이 필요하면: uv pip install --index-url https://download.pytorch.org/whl/cu126 torch==2.7.0
    "torch==2.7.0; sys_platform != 'darwin'",
    "torchvision>=0.22,<1; sys_platform != 'darwin'",
    "torchaudio>=2.7,<3; sys_platform != 'darwin'",
]

[project.optional-dependencies]
# Linux/Windows에서 CUDA 버전이 필요한 경우:
# uv sync --extra cuda
cuda = [
    "torch==2.7.0",
    "torchvision>=0.22,<1",
    "torchaudio>=2.7,<3",
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.hatch.build.targets.wheel]
packages = ["app"]

# CUDA 인덱스는 Linux/Windows에서 CUDA 버전이 필요한 경우에만 사용
# Mac에서는 sources를 지정하지 않아 기본 PyPI에서 설치됨
[[tool.uv.index]]
name = "pytorch-cu126"
url = "https://download.pytorch.org/whl/cu126"
explicit = true

# sources는 전역 설정이므로 Mac에서도 적용되어 에러 발생
# 따라서 sources를 제거하고, Mac에서는 기본 PyPI에서 설치
# Linux/Windows에서 CUDA 버전이 필요한 경우:
# 1. optional dependencies 사용: uv sync --extra cuda
# 2. 또는 수동 설치: uv pip install --index-url https://download.pytorch.org/whl/cu126 torch==2.7.0
#
# [tool.uv.sources]
# torch = { index = "pytorch-cu126" }
# torchvision = { index = "pytorch-cu126" }
# torchaudio = { index = "pytorch-cu126" }
