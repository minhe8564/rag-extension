<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ report.store_info.store_name }} Îß§Ï∂ú Î¶¨Ìè¨Ìä∏ - {{ report.monthly_report.period }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        * {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
        }

        body {
            background: linear-gradient(to bottom, #f8fafc 0%, #f1f5f9 100%);
        }

        .stat-card {
            @apply bg-white rounded-xl border border-slate-200 p-6 transition-all duration-200;
        }

        .stat-card:hover {
            @apply shadow-md border-slate-300 -translate-y-0.5;
        }

        .chart-card {
            @apply bg-white rounded-xl border border-slate-200 p-6;
        }

        .metric-badge {
            @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium;
        }

        .metric-badge-success {
            @apply bg-emerald-50 text-emerald-700 border border-emerald-200;
        }

        .metric-badge-warning {
            @apply bg-amber-50 text-amber-700 border border-amber-200;
        }

        .metric-badge-info {
            @apply bg-blue-50 text-blue-700 border border-blue-200;
        }

        @media print {
            body {
                background: white;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Ìó§Îçî -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="flex items-center gap-2">
                        <h1 class="text-xl font-bold text-slate-900">{{ report.store_info.store_name }}</h1>
                    </div>
                    <span class="metric-badge metric-badge-info">{{ report.monthly_report.period | format_date_range_korean }}</span>
                </div>
                <div class="flex items-center gap-6 text-sm text-slate-600">
                    <div class="flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span>{{ report.store_info.owner_name }}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                        </svg>
                        <span>{{ report.store_info.store_phone }}</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6">

        <!-- AI Ïù∏ÏÇ¨Ïù¥Ìä∏ -->
        <section>
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-blue-200 flex items-center justify-between bg-white/50 backdrop-blur-sm">
                    <h3 class="text-base font-semibold text-slate-900 flex items-center gap-2">
                        <span class="text-xl">ü§ñ</span>
                        AI Î∂ÑÏÑù Í≤∞Í≥º
                    </h3>
                    <span class="metric-badge metric-badge-info">{{ report.metadata.ai_model }}</span>
                </div>

                <div class="p-6 space-y-6">
                    <!-- Îß§Ï∂ú ÏöîÏïΩ -->
                    <div class="bg-white/80 backdrop-blur-sm rounded-lg border border-blue-200 p-5">
                        <h4 class="font-semibold text-slate-900 mb-3 flex items-center gap-2">
                            <span>üìù</span>
                            Îß§Ï∂ú ÏöîÏïΩ
                        </h4>
                        <p class="text-sm text-slate-700 leading-relaxed">
                            {{ report.llm_insights.sales_summary }}
                        </p>
                    </div>

                    <!-- Ï∂îÏ≤ú Îß§Ï∂ú Ï†ÑÎûµ -->
                    <div>
                        <h4 class="font-semibold text-emerald-700 mb-3 flex items-center gap-2">
                            <span>üí°</span>
                            Ï∂îÏ≤ú Îß§Ï∂ú Ï†ÑÎûµ
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            {% for strategy in report.llm_insights.sales_strategies %}
                            <div class="bg-white/80 backdrop-blur-sm rounded-lg border border-emerald-200 p-4 hover:shadow-md transition-shadow">
                                <h5 class="font-semibold text-sm text-emerald-700 mb-2">{{ loop.index }}. {{ strategy.split('ÌïòÏó¨')[0] if 'ÌïòÏó¨' in strategy else strategy.split('.')[0] }}</h5>
                                <p class="text-xs text-slate-600 leading-relaxed">{{ strategy }}</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Ï∂îÏ≤ú ÎßàÏºÄÌåÖ Ï†ÑÎûµ -->
                    <div>
                        <h4 class="font-semibold text-amber-700 mb-3 flex items-center gap-2">
                            <span>üì¢</span>
                            Ï∂îÏ≤ú ÎßàÏºÄÌåÖ Ï†ÑÎûµ
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            {% for strategy in report.llm_insights.marketing_strategies %}
                            <div class="bg-white/80 backdrop-blur-sm rounded-lg border border-amber-200 p-4 hover:shadow-md transition-shadow">
                                <h5 class="font-semibold text-sm text-amber-700 mb-2">{{ loop.index }}. {{ strategy.split('ÌïòÏó¨')[0] if 'ÌïòÏó¨' in strategy else strategy.split('Î•º')[0] }}</h5>
                                <p class="text-xs text-slate-600 leading-relaxed">{{ strategy }}</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Ï£ºÏöî Î©îÌä∏Î¶≠ Í∑∏Î¶¨Îìú -->
        <section>
            <h2 class="text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2">
                <svg class="w-5 h-5 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
                Ïù¥Î≤à Îã¨ Îß§Ï∂ú ÏöîÏïΩ
            </h2>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Ï¥ù ÌåêÎß§Í∏àÏï° -->
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg border-2 border-blue-200 p-4 hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-medium text-blue-700 uppercase tracking-wider">Ï¥ù ÌåêÎß§Í∏àÏï°</span>
                    </div>
                    <div class="text-2xl font-bold text-blue-900">{{ report.monthly_report.total_sales | humanize_currency }}</div>
                </div>

                <!-- ÌèâÍ∑† Í∞ùÎã®Í∞Ä -->
                <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-lg border-2 border-emerald-200 p-4 hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-medium text-emerald-700 uppercase tracking-wider">ÌèâÍ∑† Í∞ùÎã®Í∞Ä</span>
                    </div>
                    <div class="text-2xl font-bold text-emerald-900">{{ report.monthly_report.avg_transaction_amount | humanize_currency }}</div>
                </div>

                <!-- Ïã†Í∑ú Í≥†Í∞ù Ïàò -->
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg border-2 border-purple-200 p-4 hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-medium text-purple-700 uppercase tracking-wider">Ïã†Í∑ú Í≥†Í∞ù Ïàò</span>
                    </div>
                    <div class="text-2xl font-bold text-purple-900">{{ report.monthly_report.new_customers_count | humanize_count }}</div>
                </div>

                <!-- ÌòÑÍ∏àÏòÅÏàòÏ¶ù -->
                <div class="bg-gradient-to-br from-amber-50 to-amber-100 rounded-lg border-2 border-amber-200 p-4 hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-medium text-amber-700 uppercase tracking-wider">ÌòÑÍ∏àÏòÅÏàòÏ¶ù Î∞úÍ∏âÏï°</span>
                    </div>
                    <div class="text-2xl font-bold text-amber-900">{{ report.monthly_report.cash_receipt_amount | humanize_currency }}</div>
                </div>

                <!-- Ïû¨Î∞©Î¨∏ Í≥†Í∞ù ÎπÑÏú® -->
                <div class="bg-gradient-to-br from-rose-50 to-rose-100 rounded-lg border-2 border-rose-200 p-4 hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-medium text-rose-700 uppercase tracking-wider">Ïû¨Î∞©Î¨∏ Í≥†Í∞ù ÎπÑÏú®</span>
                    </div>
                    <div class="text-2xl font-bold text-rose-900">{{ report.monthly_report.returning_customer_rate | humanize_percentage }}</div>
                </div>

                <!-- Îß§Ï∂ú ÌîºÌÅ¨Ïùº -->
                <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-lg border-2 border-indigo-200 p-4 hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-medium text-indigo-700 uppercase tracking-wider">Îß§Ï∂ú ÌîºÌÅ¨Ïùº</span>
                    </div>
                    <div class="flex items-baseline gap-2">
                        <div class="text-2xl font-bold text-indigo-900">{{ report.monthly_report.peak_sales_date | format_date_korean }}</div>
                        <div class="text-sm text-indigo-600">{{ report.monthly_report.peak_sales_amount | humanize_currency }}</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Í∏∞Í∞ÑÎ≥Ñ TOP Îß§Ï∂úÏùº ÏÉÅÏÑ∏ Î¶¨Ìè¨Ìä∏ ÏÑπÏÖò -->
        <section>
            <div class="bg-white rounded-xl border border-slate-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-slate-200 bg-gradient-to-r from-violet-50 to-purple-50">
                    <h3 class="text-base font-semibold text-slate-900 flex items-center gap-2">
                        <span class="text-xl">üìÖ</span>
                        Í∏∞Í∞ÑÎ≥Ñ TOP Îß§Ï∂úÏùº ÏÉÅÏÑ∏ Î¶¨Ìè¨Ìä∏
                        <span class="ml-2 px-2.5 py-0.5 bg-violet-600 text-white text-xs font-medium rounded-full">{{ report.monthly_report.peak_sales_date | format_date_korean }}</span>
                    </h3>
                    <p class="text-xs text-slate-600 mt-1">Îß§Ï∂ú ÌîºÌÅ¨Ïùº Îç∞Ïù¥ÌÑ∞Î•º Í∏∞Î∞òÏúºÎ°ú Ìïú ÏÉÅÏÑ∏ Î∂ÑÏÑù</p>
                </div>

                <div class="p-6">
                    <!-- ÏùºÎ≥Ñ Î©îÌä∏Î¶≠ Ïπ¥Îìú -->
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                        <div class="bg-slate-50 rounded-lg border border-slate-200 p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs font-medium text-slate-500 uppercase tracking-wider">Ïùº Îß§Ï∂úÏï°</span>
                            </div>
                            <div class="text-xl font-bold text-slate-900">{{ report.daily_report.total_sales | humanize_currency }}</div>
                        </div>

                        <div class="bg-slate-50 rounded-lg border border-slate-200 p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs font-medium text-slate-500 uppercase tracking-wider">ÌèâÍ∑† Í∞ùÎã®Í∞Ä</span>
                            </div>
                            <div class="text-xl font-bold text-slate-900">{{ report.daily_report.avg_transaction_amount | humanize_currency }}</div>
                        </div>

                        <div class="bg-slate-50 rounded-lg border border-slate-200 p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs font-medium text-slate-500 uppercase tracking-wider">Ïã†Í∑ú Í≥†Í∞ù</span>
                            </div>
                            <div class="text-xl font-bold text-slate-900">{{ report.daily_report.new_customers_count | humanize_count }}</div>
                        </div>
                    </div>

                    <!-- ÏùºÎ≥Ñ Top 3 Í≥†Í∞ù -->
                    <div>
                        <h4 class="text-sm font-semibold text-slate-700 mb-3 flex items-center gap-2">
                            <span>üèÜ</span>
                            ÎãπÏùº Top 3 Í≥†Í∞ù
                        </h4>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-slate-50 border-b border-slate-200">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">ÏàúÏúÑ</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Í≥†Í∞ùÎ™Ö</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider">Íµ¨Îß§Í∏àÏï°</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider">Íµ¨Îß§ Í±¥Ïàò</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-200">
                                    {% for customer in report.daily_report.top_customers[:3] %}
                                    <tr class="hover:bg-slate-50 transition-colors">
                                        <td class="px-4 py-3">
                                            <span class="inline-flex items-center justify-center w-7 h-7 rounded-full {% if loop.index == 1 %}bg-amber-400 text-amber-900{% elif loop.index == 2 %}bg-slate-300 text-slate-700{% else %}bg-orange-400 text-orange-900{% endif %} font-bold text-xs">{{ loop.index }}</span>
                                        </td>
                                        <td class="px-4 py-3 font-medium text-slate-900">{{ customer.customer_name }}</td>
                                        <td class="px-4 py-3 text-right font-semibold text-slate-900">{{ customer.total_amount | humanize_currency }}</td>
                                        <td class="px-4 py-3 text-right text-slate-600">{{ customer.transaction_count | humanize_count("Ìöå") }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Ï∞®Ìä∏ ÏÑπÏÖò -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Ïû¨Î∞©Î¨∏ Í≥†Í∞ù ÎπÑÏú® -->
            <div class="chart-card">
                <div class="flex items-center justify-between mb-4 pb-4 border-b border-slate-200">
                    <h3 class="text-base font-semibold text-slate-900 flex items-center gap-2">
                        <span class="text-xl">üë•</span>
                        Ïû¨Î∞©Î¨∏ Í≥†Í∞ù ÎπÑÏú®
                    </h3>
                </div>
                <div class="flex items-center justify-center" style="height: 300px;">
                    <div style="width: 100%; max-width: 360px; height: 280px;">
                        <canvas id="returningCustomerChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Í≤∞Ï†ú ÏàòÎã® Î∂ÑÏÑù -->
            <div class="chart-card">
                <div class="flex items-center justify-between mb-4 pb-4 border-b border-slate-200">
                    <h3 class="text-base font-semibold text-slate-900 flex items-center gap-2">
                        <span class="text-xl">üí≥</span>
                        Í≤∞Ï†ú ÏàòÎã® Î∂ÑÏÑù
                    </h3>
                </div>
                <div class="flex items-center justify-center" style="height: 300px;">
                    <div style="width: 100%; max-width: 360px; height: 280px;">
                        <canvas id="paymentMethodChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- ÏùºÎ≥Ñ Îß§Ï∂ú Ï∂îÏù¥ -->
        <section>
            <div class="chart-card">
                <div class="flex items-center justify-between mb-4 pb-4 border-b border-slate-200">
                    <h3 class="text-base font-semibold text-slate-900 flex items-center gap-2">
                        <span class="text-xl">üìà</span>
                        ÏùºÎ≥Ñ Îß§Ï∂ú Ï∂îÏù¥
                    </h3>
                    <span class="text-xs text-slate-500">{{ report.monthly_report.period }}</span>
                </div>
                <div style="height: 320px;">
                    <canvas id="dailySalesTrendChart"></canvas>
                </div>
            </div>
        </section>
    </main>

    <!-- Ìë∏ÌÑ∞ -->
    <footer class="bg-slate-900 text-slate-400 py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-sm">Copyright ¬© HEBEES. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // ÏÑúÎ≤ÑÏóêÏÑú Ï£ºÏûÖÎêú Îç∞Ïù¥ÌÑ∞ (Jinja2)
        const reportData = {{ report | tojson | safe }};

        // Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú
        const data = reportData;
        const storeInfo = data.store_info;
        const dailyReport = data.daily_report;
        const monthlyReport = data.monthly_report;
        const llmInsights = data.llm_insights;
        const metadata = data.metadata;

        // Ïà´Ïûê Ìè¨Îß∑ÌåÖ Ìï®Ïàò
        function formatNumber(num) {
            return parseInt(num).toLocaleString();
        }

        // ÌçºÏÑºÌä∏ Ìè¨Îß∑ÌåÖ Ìï®Ïàò
        function formatPercent(decimal) {
            return (parseFloat(decimal) * 100).toFixed(1);
        }

        // ÎÇ†Ïßú Î≤îÏúÑ ÌïúÍµ≠Ïñ¥ Ìè¨Îß∑ÌåÖ Ìï®Ïàò
        function formatDateRangeKorean(dateRange) {
            if (!dateRange || typeof dateRange !== 'string') return dateRange;

            // Î≤îÏúÑ ÌòïÏãùÏù∏ Í≤ΩÏö∞ (YYYY-MM-DD ~ YYYY-MM-DD)
            if (dateRange.includes('~')) {
                const parts = dateRange.split('~');
                const startDate = parts[0].trim();
                const endDate = parts[1].trim();

                // ÏãúÏûëÏùº Ìè¨Îß∑ÌåÖ
                const [startYear, startMonth, startDay] = startDate.split('-');
                const startFormatted = `${startYear}ÎÖÑ ${parseInt(startMonth)}Ïõî ${parseInt(startDay)}Ïùº`;

                // Ï¢ÖÎ£åÏùº Ìè¨Îß∑ÌåÖ
                const [endYear, endMonth, endDay] = endDate.split('-');
                const endFormatted = `${endYear}ÎÖÑ ${parseInt(endMonth)}Ïõî ${parseInt(endDay)}Ïùº`;

                return `${startFormatted} ~ ${endFormatted}`;
            }

            // Îã®Ïùº Ïõî ÌòïÏãùÏù∏ Í≤ΩÏö∞ (YYYY-MM)
            if (dateRange.length === 7 && dateRange[4] === '-') {
                const [year, month] = dateRange.split('-');
                return `${year}ÎÖÑ ${parseInt(month)}Ïõî`;
            }

            return dateRange;
        }

        // Chart.js Í∏ÄÎ°úÎ≤å ÏÑ§Ï†ï
        Chart.defaults.font.family = "'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif";
        Chart.defaults.font.size = 12;
        Chart.defaults.color = '#475569';

        // DOM ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updatePageContent() {
            // Ìó§Îçî Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelector('header h1').textContent = storeInfo.store_name;
            document.querySelector('header .flex.items-center.gap-2 span:last-child').textContent = storeInfo.owner_name;
            document.querySelector('header .flex.items-center.gap-2:last-child span:last-child').textContent = storeInfo.store_phone;
            document.querySelector('.metric-badge-info').textContent = formatDateRangeKorean(monthlyReport.period);

            // ÏõîÎ≥Ñ ÏöîÏïΩ Î©îÌä∏Î¶≠ ÏóÖÎç∞Ïù¥Ìä∏ (gradient Î∞∞Í≤ΩÏùò Ïπ¥ÎìúÎì§)
            const monthlySection = document.querySelector('main > section:nth-child(2)');
            const metricCards = monthlySection.querySelectorAll('.grid > div');
            metricCards[0].querySelector('.text-2xl').textContent = formatNumber(monthlyReport.total_sales) + 'Ïõê';
            metricCards[1].querySelector('.text-2xl').textContent = formatNumber(monthlyReport.avg_transaction_amount) + 'Ïõê';
            metricCards[2].querySelector('.text-2xl').textContent = monthlyReport.new_customers_count + 'Î™Ö';
            metricCards[3].querySelector('.text-2xl').textContent = formatNumber(monthlyReport.cash_receipt_amount) + 'Ïõê';
            metricCards[4].querySelector('.text-2xl').textContent = formatPercent(monthlyReport.returning_customer_rate) + '%';

            // Îß§Ï∂ú ÌîºÌÅ¨Ïùº ÏóÖÎç∞Ïù¥Ìä∏
            const peakDate = new Date(monthlyReport.peak_sales_date);
            const peakDateStr = `${peakDate.getMonth() + 1}Ïõî ${peakDate.getDate()}Ïùº`;
            metricCards[5].querySelector('.text-2xl').textContent = peakDateStr;
            metricCards[5].querySelector('.text-sm').textContent = formatNumber(monthlyReport.peak_sales_amount) + 'Ïõê';

            // Í∏∞Í∞ÑÎ≥Ñ TOP Îß§Ï∂úÏùº ÏÑπÏÖò Ìó§ÎçîÏóê ÎÇ†Ïßú Î∞∞ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
            const peakDateBadge = document.getElementById('peakDateBadge');
            if (peakDateBadge) {
                peakDateBadge.textContent = peakDateStr;
            }

            // AI Ïù∏ÏÇ¨Ïù¥Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelector('.bg-white\\/80.backdrop-blur-sm.rounded-lg.border.border-blue-200.p-5 p').textContent = llmInsights.sales_summary;

            // ÌåêÎß§ Ï†ÑÎûµ ÏóÖÎç∞Ïù¥Ìä∏
            const salesStrategyCards = document.querySelectorAll('.grid.grid-cols-1.md\\:grid-cols-3.gap-3:first-of-type .bg-white\\/80');
            llmInsights.sales_strategies.forEach((strategy, index) => {
                if (salesStrategyCards[index]) {
                    salesStrategyCards[index].querySelector('h5').textContent = `${index + 1}. ${strategy.split('ÌïòÏó¨')[0]}`;
                    salesStrategyCards[index].querySelector('p').textContent = strategy;
                }
            });

            // ÎßàÏºÄÌåÖ Ï†ÑÎûµ ÏóÖÎç∞Ïù¥Ìä∏
            const marketingStrategyCards = document.querySelectorAll('.grid.grid-cols-1.md\\:grid-cols-3.gap-3:last-of-type .bg-white\\/80');
            llmInsights.marketing_strategies.forEach((strategy, index) => {
                if (marketingStrategyCards[index]) {
                    marketingStrategyCards[index].querySelector('h5').textContent = `${index + 1}. ${strategy.split('ÌïòÏó¨')[0].split('Î•º')[0]}`;
                    marketingStrategyCards[index].querySelector('p').textContent = strategy;
                }
            });

            // ÏùºÎ≥Ñ Î¶¨Ìè¨Ìä∏Îäî ÌîºÌÅ¨Ïùº Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö© (ÎÇ†Ïßú Î≥ÄÍ≤Ω Î∂àÍ∞Ä)
            const dailyMetricCards = document.querySelectorAll('.bg-white.rounded-xl.border.border-slate-200.overflow-hidden .bg-slate-50.rounded-lg.border.border-slate-200.p-4');
            dailyMetricCards[0].querySelector('.text-xl').textContent = formatNumber(dailyReport.total_sales) + 'Ïõê';
            dailyMetricCards[1].querySelector('.text-xl').textContent = formatNumber(dailyReport.avg_transaction_amount) + 'Ïõê';
            dailyMetricCards[2].querySelector('.text-xl').textContent = dailyReport.new_customers_count + 'Î™Ö';

            // Top 3 Í≥†Í∞ù ÏóÖÎç∞Ïù¥Ìä∏
            const topCustomerRows = document.querySelectorAll('tbody tr');
            dailyReport.top_customers.forEach((customer, index) => {
                if (topCustomerRows[index]) {
                    topCustomerRows[index].querySelector('td:nth-child(2)').textContent = customer.customer_name;
                    topCustomerRows[index].querySelector('td:nth-child(3)').textContent = formatNumber(customer.total_amount) + 'Ïõê';
                    topCustomerRows[index].querySelector('td:nth-child(4)').textContent = customer.transaction_count + 'Ìöå';
                }
            });
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏóÖÎç∞Ïù¥Ìä∏
        updatePageContent();

        // Ïû¨Î∞©Î¨∏ Í≥†Í∞ù ÎπÑÏú® ÎèÑÎÑõ Ï∞®Ìä∏
        const returningCustomerCtx = document.getElementById('returningCustomerChart').getContext('2d');
        const returningRate = parseFloat(formatPercent(monthlyReport.returning_customer_rate));
        const newCustomerRate = 100 - returningRate;

        new Chart(returningCustomerCtx, {
            type: 'doughnut',
            data: {
                labels: ['Ïû¨Î∞©Î¨∏ Í≥†Í∞ù', 'Ïã†Í∑ú Í≥†Í∞ù'],
                datasets: [{
                    data: [returningRate, newCustomerRate],
                    backgroundColor: ['rgba(16, 185, 129, 0.9)', 'rgba(226, 232, 240, 0.9)'],
                    borderColor: ['rgba(16, 185, 129, 1)', 'rgba(226, 232, 240, 1)'],
                    borderWidth: 2,
                    hoverOffset: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        align: 'center',
                        fullSize: false,
                        labels: {
                            padding: 15,
                            font: {
                                size: 11,
                                family: "'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"
                            },
                            usePointStyle: true,
                            pointStyle: 'circle',
                            boxWidth: 8,
                            boxHeight: 8,
                            generateLabels: (chart) => {
                                return chart.data.labels.map((label, i) => ({
                                    text: `${label}: ${chart.data.datasets[0].data[i]}%`,
                                    fillStyle: chart.data.datasets[0].backgroundColor[i],
                                    strokeStyle: chart.data.datasets[0].borderColor[i],
                                    lineWidth: 2,
                                    hidden: false,
                                    index: i
                                }));
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.9)',
                        padding: 12,
                        bodyFont: { size: 13 },
                        callbacks: {
                            label: (ctx) => `${ctx.label}: ${ctx.parsed}%`
                        }
                    }
                },
                cutout: '65%',
                animation: {
                    animateRotate: true,
                    animateScale: true,
                    duration: 1000,
                    easing: 'easeOutQuart'
                }
            }
        });

        // Í≤∞Ï†ú ÏàòÎã® Î∂ÑÏÑù ÎèÑÎÑõ Ï∞®Ìä∏
        const paymentMethodCtx = document.getElementById('paymentMethodChart').getContext('2d');
        const cardRate = parseFloat(formatPercent(monthlyReport.payment_breakdown.card));
        const cashRate = parseFloat(formatPercent(monthlyReport.payment_breakdown.cash));
        const voucherRate = parseFloat(formatPercent(monthlyReport.payment_breakdown.voucher));

        new Chart(paymentMethodCtx, {
            type: 'doughnut',
            data: {
                labels: ['Ïπ¥Îìú', 'ÌòÑÍ∏à', 'ÏÉÅÌíàÍ∂å'],
                datasets: [{
                    data: [cardRate, cashRate, voucherRate],
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.9)',
                        'rgba(245, 158, 11, 0.9)',
                        'rgba(16, 185, 129, 0.9)'
                    ],
                    borderColor: [
                        'rgba(59, 130, 246, 1)',
                        'rgba(245, 158, 11, 1)',
                        'rgba(16, 185, 129, 1)'
                    ],
                    borderWidth: 2,
                    hoverOffset: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        align: 'center',
                        fullSize: false,
                        labels: {
                            padding: 15,
                            font: {
                                size: 11,
                                family: "'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"
                            },
                            usePointStyle: true,
                            pointStyle: 'circle',
                            boxWidth: 8,
                            boxHeight: 8,
                            generateLabels: (chart) => {
                                return chart.data.labels.map((label, i) => ({
                                    text: `${label}: ${chart.data.datasets[0].data[i]}%`,
                                    fillStyle: chart.data.datasets[0].backgroundColor[i],
                                    strokeStyle: chart.data.datasets[0].borderColor[i],
                                    lineWidth: 2,
                                    hidden: false,
                                    index: i
                                }));
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.9)',
                        padding: 12,
                        bodyFont: { size: 13 },
                        callbacks: {
                            label: (ctx) => `${ctx.label}: ${ctx.parsed}%`
                        }
                    }
                },
                cutout: '65%',
                animation: {
                    animateRotate: true,
                    animateScale: true,
                    duration: 1000,
                    easing: 'easeOutQuart'
                }
            }
        });

        // ÏùºÎ≥Ñ Îß§Ï∂ú Ï∂îÏù¥ ÎùºÏù∏ Ï∞®Ìä∏
        const dailySalesTrendCtx = document.getElementById('dailySalesTrendChart').getContext('2d');

        // API Îç∞Ïù¥ÌÑ∞ÏóêÏÑú ÏùºÎ≥Ñ Îß§Ï∂ú Ï∂îÏù¥ Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú
        const dailySalesData = monthlyReport.daily_sales_trend.map(item => ({
            date: new Date(item.sale_date).toLocaleDateString('ko-KR', { month: 'numeric', day: 'numeric' }).replace('. ', '/').replace('.', ''),
            sales: parseInt(item.sales_amount)
        }));

        // ÌîºÌÅ¨Ïùº Ïù∏Îç±Ïä§ Ï∞æÍ∏∞
        const peakDateFormatted = new Date(monthlyReport.peak_sales_date).toLocaleDateString('ko-KR', { month: 'numeric', day: 'numeric' }).replace('. ', '/').replace('.', '');
        const peakIndex = dailySalesData.findIndex(item => item.date === peakDateFormatted);

        new Chart(dailySalesTrendCtx, {
            type: 'line',
            data: {
                labels: dailySalesData.map(d => d.date),
                datasets: [{
                    label: 'ÏùºÎ≥Ñ Îß§Ï∂ú',
                    data: dailySalesData.map(d => d.sales),
                    borderColor: 'rgba(99, 102, 241, 1)',
                    backgroundColor: (context) => {
                        const ctx = context.chart.ctx;
                        const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                        gradient.addColorStop(0, 'rgba(99, 102, 241, 0.3)');
                        gradient.addColorStop(0.5, 'rgba(99, 102, 241, 0.1)');
                        gradient.addColorStop(1, 'rgba(99, 102, 241, 0)');
                        return gradient;
                    },
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointRadius: (context) => {
                        // ÌîºÌÅ¨ÏùºÏùÑ Îçî ÌÅ¨Í≤å ÌëúÏãú
                        return context.dataIndex === peakIndex ? 8 : 4;
                    },
                    pointHoverRadius: 8,
                    pointBackgroundColor: (context) => {
                        // ÌîºÌÅ¨ÏùºÏùÑ Îπ®Í∞ÑÏÉâÏúºÎ°ú Í∞ïÏ°∞
                        return context.dataIndex === peakIndex ? 'rgba(239, 68, 68, 1)' : 'rgba(99, 102, 241, 1)';
                    },
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointHoverBackgroundColor: 'rgba(239, 68, 68, 1)',
                    pointHoverBorderColor: '#fff',
                    pointHoverBorderWidth: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.95)',
                        padding: 16,
                        titleFont: { size: 14, weight: 'bold' },
                        bodyFont: { size: 14 },
                        borderColor: 'rgba(99, 102, 241, 0.5)',
                        borderWidth: 1,
                        displayColors: false,
                        callbacks: {
                            title: (ctx) => ctx[0].label,
                            label: (ctx) => {
                                const value = parseInt(ctx.parsed.y);
                                const isPeak = ctx.dataIndex === peakIndex;
                                return `${isPeak ? 'üî• ' : ''}Îß§Ï∂ú: ${value.toLocaleString()}Ïõê${isPeak ? ' (ÌîºÌÅ¨)' : ''}`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: (value) => `${(value / 10000).toFixed(0)}ÎßåÏõê`,
                            font: {
                                size: 11
                            },
                            color: '#64748b'
                        },
                        grid: {
                            color: 'rgba(148, 163, 184, 0.08)',
                            drawBorder: false
                        },
                        border: {
                            display: false
                        }
                    },
                    x: {
                        ticks: {
                            maxRotation: 0,
                            autoSkip: true,
                            maxTicksLimit: 15,
                            font: {
                                size: 11
                            },
                            color: '#64748b'
                        },
                        grid: {
                            display: false
                        },
                        border: {
                            display: false
                        }
                    }
                }
            }
        });

    </script>
</body>
</html>
